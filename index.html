<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Start Vitals</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-512.png">
<meta name="theme-color" content="#3498db">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then(registration => {
        // Store registration for update checking
        window.swRegistration = registration;
        
        // Check for updates periodically
        setInterval(() => {
          registration.update();
        }, 60 * 60 * 1000); // Check every hour
      }).catch(()=>{/*sw failed*/});
    });
  }
</script>
<script>
// Warn when the page is opened directly via file:// (origin 'null') which blocks module loading
if (location.protocol === 'file:' || location.origin === 'null') {
  document.addEventListener('DOMContentLoaded', () => {
    const warn = document.createElement('div');
    warn.className = 'alert-banner alert-amber';
    warn.style.margin = '10px';
    warn.style.position = 'fixed';
    warn.style.left = '10px';
    warn.style.right = '10px';
    warn.style.zIndex = '1001';
    warn.textContent = 'This app must be served over HTTP/HTTPS to load modules. Run a local server (e.g., `py -3 -m http.server 8000`) and open http://localhost:8000';
    document.body.appendChild(warn);
  });
}
</script>
<script type="module" src="./app.js"></script>
<style>
:root{
  --primary-bg:#f4f7f9;
  --secondary-bg:rgba(255,255,255,0.9);
  --border-color:#dbe2e8;
  --text-color:#2c3e50;
  --primary-accent:#3498db;
  --secondary-accent:#2ecc71;
  --warn-amber:#f39c12;
  --warn-red:#e74c3c;
  --font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --normal-green:#27ae60;
  --abnormal-orange:#e67e22;
  --critical-red:#c0392b;
}
*{box-sizing:border-box}
body{
  font-family:var(--font-family);
  background-color:var(--primary-bg);
  background-image:url('icon-512.png');
  background-repeat:no-repeat;
  background-position:center;
  background-size:150px 150px;
  color:var(--text-color);
  margin:0;
  padding:10px;
  font-size:16px;
}
.container{
  max-width:900px;
  margin:0 auto;
  background-color:var(--secondary-bg);
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  overflow:hidden;
  padding:0;
}
.header {
  padding:12px 18px;
  border-bottom:1px solid var(--border-color);
  display:flex;
  align-items:center;
  gap:12px;
}
.app-title { font-weight:700; font-size:1.1rem; color:var(--primary-accent); }
.controls { margin-left:auto; font-size:0.9rem; color:#666; display:flex; gap:8px; align-items:center; }
.tab-nav{ display:flex; background:#ecf0f1; border-bottom:1px solid var(--border-color); overflow-x:auto;}
.tab-button{
  padding:12px 16px; border:none; background:transparent; cursor:pointer;
  font-size:1rem; font-weight:600; color:var(--text-color); white-space:nowrap;
}
.tab-button.active{ background:var(--primary-accent); color:#fff; border-bottom:3px solid var(--secondary-accent); }
.tab-content{ display:none; padding:18px; animation:fadeIn .25s ease; }.tab-content.active { display: block; }@keyframes fadeIn{ from{opacity:0} to{opacity:1} }
.form-group{ margin-bottom:16px; }
.form-group label{ display:block; font-weight:600; margin-bottom:8px; }
.form-group input, .form-group textarea, .form-group select{
  width:100%; padding:10px; border:1px solid var(--border-color); border-radius:4px; font-size:1rem;
  transition: border-color 0.3s, box-shadow 0.3s;
}
.input-group{ display:flex; gap:10px; align-items:center; }
.input-group input{ flex:1; }
.input-group-addon{ background:#ecf0f1; padding:10px; border:1px solid var(--border-color); border-radius:4px; }
.gcs-section{ margin-bottom:18px; border:1px solid var(--border-color); border-radius:6px; padding:12px; }
.gcs-option{ display:block; margin-bottom:8px; }
#gcs-total{ font-size:1.2rem; font-weight:700; text-align:center; padding:10px; background:var(--primary-accent); color:#fff; border-radius:6px; margin-top:10px; }
.btn{ padding:10px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:700; }
.btn-primary{ background:var(--secondary-accent); color:#fff; }
.btn-secondary{ background:#bdc3c7; color: var(--text-color); }
.btn-danger{ background:#e74c3c; color:#fff; }
.btn-info{ background:#17a2b8; color:#fff; }
.btn-results { background: #9b59b6; color: white; }
.small{ font-size:0.9rem; color:#555; }
#results-output{ white-space:pre-wrap; background:#ecf0f1; border:1px solid var(--border-color); padding:12px; border-radius:6px; min-height:180px; font-family:"Courier New", monospace; }
.kv { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
.kv label{ min-width:110px; font-weight:700; color:#333; }
.alert-banner{
  padding:10px 12px; border-radius:6px; color:#fff; margin-bottom:12px; font-weight:700;
  display:flex; align-items:center; gap:10px;
}
.alert-none{ display:none; }
.alert-amber{ background:var(--warn-amber); }
.alert-red{ background:var(--warn-red); }
.alert-info{ background:#17a2b8; }
.log-list{ border:1px dashed var(--border-color); padding:8px; border-radius:6px; max-height:200px; overflow:auto; background:#fff; }
.log-item{ padding:6px 8px; border-bottom:1px solid #f1f1f1; font-size:0.95rem; }
.meta{ font-size:0.85rem; color:#666; }
.toggle-row{ display:flex; align-items:center; gap:8px; }
.row { display:flex; gap:10px; align-items:center; }
.flex-2{ flex:2; }
.flex-1{ flex:1; }
.small-btn{ padding:6px 8px; border-radius:6px; font-weight:700; border:none; cursor:pointer; }
.ghost{ background:transparent; border:1px solid var(--border-color); }

/* New styles for vitals chart */
.vitals-chart {
  display: flex;
  align-items: flex-end;
  height: 100px;
  margin: 10px 0;
  border-left: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
}
.chart-title {
  width: 100%;
  text-align: center;
  font-size: 0.9rem;
  margin-bottom: 5px;
}
.chart-bar {
  flex: 1;
  background-color: var(--primary-accent);
  margin: 0 2px;
  min-height: 5px;
}

/* Patient selector styles */
.patient-selector {
  margin-bottom: 16px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 6px;
  border: 1px solid var(--border-color);
}
.patient-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}
.patient-chip {
  padding: 6px 12px;
  background: #bdc3c7; /* Changed to grey for inactive patients */
  color: white;
  border-radius: 20px;
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}
.patient-chip.active {
  background: var(--secondary-accent); /* Green for active patient */
}
.patient-chip .remove {
  font-weight: bold;
  margin-left: 4px;
}
.patient-chip .remove { font-weight: bold; margin-left: 4px; }
.patient-chip .remove { font-weight: bold; margin-left: 4px; }
.patient-chip .remove { font-weight: bold; margin-left: 4px; }
.patient-chip .remove { font-weight: bold; margin-left: 4px; }
.current-patient {
  font-weight: bold;
  color: var(--primary-accent);
  margin-bottom: 8px;
}

/* Current patient display for tabs */
.tab-patient-header {
  background: #f0f7f4;
  border-left: 4px solid var(--secondary-accent);
  padding: 8px 12px;
  margin: -18px -18px 16px -18px;
  font-weight: 600;
  color: var(--secondary-accent);
  display: flex;
  align-items:center;
  gap: 8px;
}
.tab-patient-header .patient-indicator {
  font-size: 0.8rem;
  background: var(--secondary-accent);
  color: white;
  padding: 2px 6px;
  border-radius: 10px;
}

/* Update notification styles */
.update-notification {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--primary-accent);
  color: white;
  padding: 12px 16px;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 1000;
  max-width: 300px;
}
.update-notification .update-actions {
  margin-top: 8px;
  display: flex;
  gap: 8px;
}
.update-notification .update-actions button {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

/* Options group styling */
.options-group {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}
.options-group .form-group {
  margin-bottom: 0;
  flex: 1;
}

/* Priority indicator styles */
.priority-indicator {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: bold;
  font-size: 0.85rem;
  margin-left: 8px;
}
.priority-p1 { background: #e74c3c; color: white; }
.priority-p2 { background: #f39c12; color: white; }
.priority-p3 { background: #3498db; color: white; }
.priority-p4 { background: #95a5a6; color: white; }

/* Color-coded vital indicators */
.vital-normal {
  border-color: var(--normal-green) !important;
  box-shadow: 0 0 0 2px rgba(39, 174, 96, 0.2) !important;
}
.vital-abnormal {
  border-color: var(--abnormal-orange) !important;
  box-shadow: 0 0 0 2px rgba(230, 126, 34, 0.2) !important;
}
.vital-critical {
  border-color: var(--critical-red) !important;
  box-shadow: 0 0 0 2px rgba(192, 57, 43, 0.3) !important;
}

/* Color indicators in log display */
.vital-value-normal { color: var(--normal-green); font-weight: 600; }
.vital-value-abnormal { color: var(--abnormal-orange); font-weight: 600; }
.vital-value-critical { color: var(--critical-red); font-weight: 700; }

/* Info icon and modal styles */
.info-icon {
  display: inline-block;
  width: 16px;
  height: 16px;
  background-color: var(--primary-accent);
  color: white;
  border-radius: 50%;
  text-align: center;
  line-height: 16px;
  font-size: 12px;
  font-weight: bold;
  margin-left: 6px;
  cursor: pointer;
  vertical-align: middle;
}

.info-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
  overflow: auto;
}

.info-modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 500px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  position: relative;
}

.info-modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  font-weight: bold;
  color: #777;
  cursor: pointer;
}

.info-modal-close:hover {
  color: #333;
}

.vital-range-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
.vital-range-table th, .vital-range-table td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}
.vital-range-table th {
  background-color: #f2f2f2;
}
.range-normal { color: var(--normal-green); font-weight: 600; }
.range-abnormal { color: var(--abnormal-orange); font-weight: 600; }
.range-critical { color: var(--critical-red); font-weight: 700; }

/* Results modal styles */
.results-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
  overflow: auto;
}

.results-modal-content {
  background-color: #fff;
  margin: 2% auto;
  padding: 0;
  border-radius: 8px;
  width: 95%;
  max-width: 900px;
  max-height: 95vh;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  position: relative;
  overflow: hidden;
}

.results-modal-header {
  background: var(--primary-accent);
  color: white;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.results-modal-close {
  font-size: 28px;
  font-weight: bold;
  color: white;
  cursor: pointer;
  background: none;
  border: none;
}

.results-modal-close:hover {
  opacity: 0.8;
}

.results-modal-body {
  padding: 20px;
  max-height: calc(95vh - 60px);
  overflow-y: auto;
}

/* Three-dot menu styles */
.menu-container {
  position: relative;
  display: inline-block;
}

.menu-button {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text-color);
  cursor: pointer;
  padding: 5px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

.menu-button:hover {
  background-color: rgba(0,0,0,0.1);
}

.menu-dropdown {
  display: none;
  position: absolute;
  right: 0;
  top: 100%;
  background-color: white;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1001;
  border-radius: 6px;
  overflow: hidden;
  margin-top: 5px;
}

.menu-dropdown a {
  color: var(--text-color);
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 14px;
  transition: background-color 0.3s;
}

.menu-dropdown a:hover {
  background-color: #f1f1f1;
}

.show { display: block; }

/* Pupils input group styling */
.pupils-input-group {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}
.pupils-input-group input {
  flex: 1;
  min-width: 80px;
}
.pupils-checkbox {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
}
.pupils-checkbox input[type="checkbox"] {
  width: auto;
  margin: 0;
}
.pupils-checkbox label {
  font-weight: normal;
  margin: 0;
  font-size: 0.9rem;
  color: var(--text-color);
}

/* GCS Info Section Styles */
.gcs-info-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.gcs-section-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 10px;
}

.gcs-total-info {
  margin-top: 20px;
  padding: 12px;
  background-color: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid var(--primary-accent);
}

.gcs-total-info h4 {
  margin-top: 0;
  margin-bottom: 8px;
  color: var(--primary-accent);
}

.gcs-total-info p {
  margin-bottom: 6px;
}

.gcs-total-info ul {
  margin-top: 8px;
  margin-bottom: 0;
  padding-left: 20px;
}

@media (max-width:700px){
  .kv label{ min-width:90px; }
  .header{ flex-direction:column; align-items:flex-start; gap:6px; }
  .controls { flex-direction: column; align-items: flex-start; margin-left: 0; margin-top: 8px; width: 100%; }
  .controls .menu-container { align-self: flex-end; }
  .options-group {
    flex-direction: column;
    gap: 8px;
  }
  .info-modal-content {
    width: 95%;
    margin: 5% auto;
  }
  .results-modal-content {
    width: 98%;
    margin: 1% auto;
  }
  .pupils-input-group {
    flex-direction: column;
    align-items: stretch;
  }
  .pupils-checkbox {
    margin-top: 6px;
  }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="app-title">Start Vitals</div>
    <div class="controls">
      <button class="btn btn-results" onclick="showResults()">Results</button>
      <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu()">⋮</button>
        <div id="menu-dropdown" class="menu-dropdown">
          <a href="#" onclick="checkForUpdates(); toggleMenu(); return false;">Check for Updates</a>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-nav" role="tablist">
    <button class="tab-button active" onclick="openTab(event,'patient-info')">Patient Info</button>
    <button class="tab-button" onclick="openTab(event,'vitals')">Vitals</button>
    <button class="tab-button" onclick="openTab(event,'gcs')">GCS</button>
    <button class="tab-button" onclick="openTab(event,'notes')">Notes</button>
  </div>

  <!-- PATIENT INFO -->
  <div id="patient-info" class="tab-content active">
    <div class="tab-patient-header">
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="patient-info-current">New Patient</span>
    </div>
    
    <h2>Patient Information</h2>
    
    <!-- Patient selector -->
    <div class="patient-selector">
      <div class="form-group">
        <label>Current Patient</label>
        <div id="current-patient-display" class="current-patient">New Patient</div>
        <div id="patient-list" class="patient-list"></div>
        <button id="add-patient-btn" class="btn btn-primary small-btn" onclick="addPatient()" style="margin-top: 8px;">+ Add Patient</button>
      </div>
    </div>

    <div class="form-group">
      <label for="patient-name">Name</label>
      <input id="patient-name" placeholder="e.g., John Doe" onchange="patientNameChanged()">
    </div>
    <div class="form-group">
      <label for="responder-id">Responder ID</label>
      <input id="responder-id" placeholder="e.g., ST186" onchange="patientInfoChanged()">
    </div>

  <!-- VITALS -->
  <div id="vitals" class="tab-content">
    <div class="tab-patient-header">
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="vitals-current">New Patient</span>
    </div>
    
    <h2>Vitals</h2>
    <div id="vitals-alert" class="alert-banner alert-none"></div>

    <!-- Patient Priority -->
    <div class="form-group">
      <label for="patient-priority">Patient Priority</label>
      <select id="patient-priority" onchange="patientPriorityChanged()">
        <option value="">Select priority</option>
        <option value="P1">P1 - Immediate (Critical/Urgent)</option>
        <option value="P2">P2 - Urgent (Serious)</option>
        <option value="P3">P3 - Delayed (Walking Wounded)</option>
        <option value="P4">P4 - Deceased</option>
      </select>
    </div>

    <div class="form-group">
      <label>Blood Pressure (mmHg)<span class="info-icon" onclick="showVitalInfo('bp')">?</span></label>
      <div class="input-group">
        <input id="bp-sys" type="number" placeholder="Systolic" oninput="updateVitalIndicator(this, 'bp-sys')">
        <span>/</span>
        <input id="bp-dia" type="number" placeholder="Diastolic" oninput="updateVitalIndicator(this, 'bp-dia')">
        <span class="input-group-addon">mmHg</span>
      </div>
    </div>

    <div class="form-group">
      <label for="pulse">Pulse<span class="info-icon" onclick="showVitalInfo('pulse')">?</span></label>
      <div class="input-group">
        <input id="pulse" type="number" placeholder="e.g., 80" oninput="updateVitalIndicator(this, 'pulse')">
        <span class="input-group-addon">bpm</span>
      </div>
    </div>

    <div class="form-group">
      <label for="spo2">SPO₂<span class="info-icon" onclick="showVitalInfo('spo2')">?</span></label>
      <div class="input-group">
        <input id="spo2" type="number" placeholder="e.g., 98" oninput="updateVitalIndicator(this, 'spo2')">
        <span class="input-group-addon">%</span>
      </div>
    </div>

    <div class="form-group">
      <label>O₂ Delivery<span class="info-icon" onclick="showVitalInfo('o2')">?</span></label>
      <select id="o2-delivery">
        <option value="">None</option>
        <option value="nasal">Nasal Cannula</option>
        <option value="mask">Face Mask</option>
        <option value="non-rebreather">Non-rebreather Mask</option>
        <option value="bag-valve">Bag-Valve Mask</option>
      </select>
    </div>

    <div class="form-group">
      <label for="o2-flow">O₂ Flow Rate<span class="info-icon" onclick="showVitalInfo('o2-flow')">?</span></label>
      <div class="input-group">
        <input id="o2-flow" type="number" placeholder="e.g., 2" step="0.5">
        <span class="input-group-addon">L/min</span>
      </div>
    </div>

    <div class="form-group">
      <label for="rrate">Respiratory Rate<span class="info-icon" onclick="showVitalInfo('rrate')">?</span></label>
      <div class="input-group">
        <input id="rrate" type="number" placeholder="e.g., 16" oninput="updateVitalIndicator(this, 'rrate')">
        <span class="input-group-addon">/min</span>
      </div>
    </div>

    <div class="form-group">
      <label for="hgt">Blood Glucose (HGT)<span class="info-icon" onclick="showVitalInfo('hgt')">?</span></label>
      <div class="input-group">
        <input id="hgt" type="number" step="0.1" placeholder="e.g., 5.5" oninput="updateVitalIndicator(this, 'hgt')">
        <span class="input-group-addon">mmol/L</span>
      </div>
    </div>

    <div class="form-group">
      <label for="temp">Temperature<span class="info-icon" onclick="showVitalInfo('temp')">?</span></label>
      <div class="input-group">
        <input id="temp" type="number" step="0.1" placeholder="e.g., 36.8" oninput="updateVitalIndicator(this, 'temp')">
        <span class="input-group-addon">°C</span>
      </div>
    </div>

    <div class="form-group">
      <label for="cap-refill">Capillary Refill<span class="info-icon" onclick="showVitalInfo('cap-refill')">?</span></label>
      <div class="input-group">
        <input id="cap-refill" type="number" placeholder="e.g., 2" oninput="updateVitalIndicator(this, 'cap-refill')">
        <span class="input-group-addon">s</span>
      </div>
    </div>

    <div class="form-group">
      <label>Pupils (Left / Right)<span class="info-icon" onclick="showVitalInfo('pupils')">?</span></label>
      <div class="pupils-input-group">
        <input id="pupil-left" type="number" placeholder="L mm">
        <input id="pupil-right" type="number" placeholder="R mm">
        <span class="input-group-addon">mm</span>
      </div>
      <div class="pupils-checkbox">
        <input type="checkbox" id="pupils-reactive" onchange="patientInfoChanged()">
        <label for="pupils-reactive">Pupils reactive to light</label>
      </div>
    </div>

    <div class="form-group">
      <label for="pain">Pain Score<span class="info-icon" onclick="showVitalInfo('pain')">?</span></label>
      <div class="input-group">
        <input id="pain" type="number" min="0" max="10" placeholder="e.g., 7" oninput="updateVitalIndicator(this, 'pain')">
        <span class="input-group-addon">/10</span>
      </div>
    </div>

    <!-- New fields -->
    <div class="form-group">
      <label for="ecg">ECG Rhythm<span class="info-icon" onclick="showVitalInfo('ecg')">?</span></label>
      <select id="ecg">
        <option value="">Select rhythm</option>
        <option value="sinus">Sinus</option>
        <option value="sinus-tach">Sinus Tachycardia</option>
        <option value="sinus-brady">Sinus Bradycardia</option>
        <option value="afib">Atrial Fibrillation</option>
        <option value="vtach">Ventricular Tachycardia</option>
        <option value="vfib">Ventricular Fibrillation</option>
        <option value="asystole">Asystole</option>
        <option value="other">Other</option>
      </select>
    </div>

    <div class="form-group">
      <label for="pain-location">Pain Location<span class="info-icon" onclick="showVitalInfo('pain-location')">?</span></label>
      <input id="pain-location" placeholder="e.g., Chest, Left arm">
    </div>

    <div class="form-group">
      <label for="skin">Skin Condition<span class="info-icon" onclick="showVitalInfo('skin')">?</span></label>
      <select id="skin">
        <option value="">Select condition</option>
        <option value="normal">Normal</option>
        <option value="pale">Pale</option>
        <option value="cyanotic">Cyanotic</option>
        <option value="flushed">Flushed</option>
        <option value="mottled">Mottled</option>
        <option value="diaphoretic">Diaphoretic</option>
      </select>
    </div>

    <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
      <button class="btn btn-primary" onclick="submitVitals()">Submit Vitals</button>
      <button class="btn ghost small-btn" onclick="clearVitalsInputs()">Clear Inputs</button>
      <div style="margin-left:auto;" class="small">Vitals log kept locally for this patient</div>
    </div>

    <div>
      <label class="small">Recent Vitals (newest first)</label>
      <div id="vitals-log" class="log-list" aria-live="polite"></div>
    </div>

    <!-- Vitals chart -->
    <div id="vitals-chart-container"></div>
  </div>

  <!-- GCS -->
  <div id="gcs" class="tab-content">
    <div class="tab-patient-header">
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="gcs-current">New Patient</span>
    </div>
    
    <h2>Glasgow Coma Scale (GCS)</h2>
    <div id="gcs-alert" class="alert-banner alert-none"></div>

    <div class="gcs-section">
      <div class="gcs-info-header">
        <h3 class="gcs-section-title">Eye Opening Response<span class="info-icon" onclick="showVitalInfo('gcs-eye')">?</span></h3>
      </div>
      <label class="gcs-option"><input type="radio" name="gcs-eye" value="4"> Spontaneous (4)</label>
      <label class="gcs-option"><input type="radio" name="gcs-eye" value="3"> To Speech (3)</label>
      <label class="gcs-option"><input type="radio" name="gcs-eye" value="2"> To Pain (2)</label>
      <label class="gcs-option"><input type="radio" name="gcs-eye" value="1"> No Response (1)</label>
    </div>

    <div class="gcs-section">
      <div class="gcs-info-header">
        <h3 class="gcs-section-title">Verbal Response<span class="info-icon" onclick="showVitalInfo('gcs-verbal')">?</span></h3>
      </div>
      <label class="gcs-option"><input type="radio" name="gcs-verbal" value="5"> Orientated (5)</label>
      <label class="gcs-option"><input type="radio" name="gcs-verbal" value="4"> Confused (4)</label>
      <label class="gcs-option"><input type="radio" name="gcs-verbal" value="3"> Inappropriate Words (3)</label>
      <label class="gcs-option"><input type="radio" name="gcs-verbal" value="2"> Incomprehensible Sounds (2)</label>
      <label class="gcs-option"><input type="radio" name="gcs-verbal" value="1"> No Response (1)</label>
    </div>

    <div class="gcs-section">
      <div class="gcs-info-header">
        <h3 class="gcs-section-title">Motor Response<span class="info-icon" onclick="showVitalInfo('gcs-motor')">?</span></h3>
      </div>
      <label class="gcs-option"><input type="radio" name="gcs-motor" value="6"> Obeys Commands (6)</label>
      <label class="gcs-option"><input type="radio" name="gcs-motor" value="5"> Localises to Pain (5)</label>
      <label class="gcs-option"><input type="radio" name="gcs-motor" value="4"> Withdraws from Pain (4)</label>
      <label class="gcs-option"><input type="radio" name="gcs-motor" value="3"> Flexion to Pain (decorticate) (3)</label>
      <label class="gcs-option"><input type="radio" name="gcs-motor" value="2"> Extension to Pain (decerebrate) (2)</label>
      <label class="gcs-option"><input type="radio" name="gcs-motor" value="1"> No Response (1)</label>
    </div>

    <div id="gcs-total" class="meta">Total GCS Score: 0 / 15</div>
    
    <div class="gcs-total-info">
      <h4>GCS Score Interpretation<span class="info-icon" onclick="showVitalInfo('gcs-total')">?</span></h4>
      <p>The Glasgow Coma Scale provides a standardized way to assess a patient's level of consciousness:</p>
      <ul>
        <li><strong>13-15:</strong> Mild brain injury</li>
        <li><strong>9-12:</strong> Moderate brain injury</li>
        <li><strong>3-8:</strong> Severe brain injury</li>
        <li><strong>3:</strong> Deep coma or brain death</li>
      </ul>
      <p>Score of 8 or less typically indicates the need for airway protection.</p>
    </div>

    <div style="display:flex; gap:8px; align-items:center; margin-top:12px; margin-bottom:12px;">
      <button class="btn btn-primary" onclick="submitGCS()">Submit GCS</button>
      <button class="btn ghost small-btn" onclick="clearGCSInputs()">Clear</button>
      <div style="margin-left:auto;" class="small">GCS log kept locally for this patient</div>
    </div>

    <div>
      <label class="small">Recent GCS (newest first)</label>
      <div id="gcs-log" class="log-list" aria-live="polite"></div>
    </div>
  </div>

  <!-- NOTES -->
  <div id="notes" class="tab-content">
    <div class="tab-patient-header">
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="notes-current">New Patient</span>
    </div>
    
    <h2>Signs/Symptoms & Notes</h2>

    <div class="form-group">
      <label for="signs-symptoms">Signs / Symptoms (static entry)</label>
      <textarea id="signs-symptoms" placeholder="Describe patient's signs and symptoms..." onchange="patientInfoChanged()"></textarea>
    </div>

    <div class="form-group">
      <label for="general-note">Add a timed note</label>
      <textarea id="general-note" placeholder="e.g., Patient reports chest pain..."></textarea>
    </div>

    <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
      <button class="btn btn-primary" onclick="addNote()">Add Note</button>
      <button class="btn ghost small-btn" onclick="clearNoteInput()">Clear</button>
    </div>

    <!-- Audio recording -->
    <div class="form-group">
      <button id="record-note" class="btn btn-secondary">Record Audio Note</button>
      <div id="audio-notes" class="log-list"></div>
    </div>

    <div>
      <label class="small">Notes (newest first)</label>
      <div id="notes-log" class="log-list" aria-live="polite"></div>
    </div>
  </div>

  <!-- Update notification (hidden by default) -->
  <div id="update-notification" class="update-notification" style="display: none;">
    <div>A new version of the app is available!</div>
    <div class="update-actions">
      <button onclick="applyUpdate()">Update Now</button>
      <button onclick="dismissUpdate()">Later</button>
    </div>
  </div>

  <!-- Vital Info Modal -->
  <div id="vital-info-modal" class="info-modal">
    <div class="info-modal-content">
      <span class="info-modal-close" onclick="closeVitalInfo()">&times;</span>
      <h3 id="vital-info-title">Vital Information</h3>
      <div id="vital-info-content"></div>
    </div>
  </div>

  <!-- Results Modal -->
  <div id="results-modal" class="results-modal">
    <div class="results-modal-content">
      <div class="results-modal-header">
        <h2>Consolidated Results</h2>
        <button class="results-modal-close" onclick="closeResults()">&times;</button>
      </div>
      <div class="results-modal-body">
        <div id="results-alert" class="alert-banner alert-none"></div>

        <div class="options-group">
          <div class="form-group">
            <label class="toggle-row"><input type="checkbox" id="show-timestamps" checked> Include timestamps</label>
          </div>
          <div class="form-group">
            <label class="toggle-row"><input type="checkbox" id="sbar-format"> Use SBAR format</label>
          </div>
        </div>

        <div class="form-group">
          <button class="btn btn-primary" onclick="generateResults()">Generate Handover Results</button>
          <button class="btn btn-danger" style="margin-left:8px" onclick="startNewScene()">Start New Scene</button>
        </div>

        <div class="form-group">
          <label for="results-output">Copy the text below:</label>
          <textarea id="results-output" readonly></textarea>
        </div>

        <div style="display:flex; gap:8px;">
          <button class="btn btn-secondary" onclick="copyResults()">Copy to Clipboard</button>
          <button class="btn ghost small-btn" onclick="downloadReport()">Download .txt</button>
        </div>
      </div>
    </div>
  </div>

:root{
  --primary-bg:#f4f7f9;
  --secondary-bg:rgba(255,255,255,0.9);
  --border-color:#dbe2e8;
  --text-color:#2c3e50;
  --primary-accent:#3498db;
  --secondary-accent:#2ecc71;
  --warn-amber:#f39c12;
  --warn-red:#e74c3c;
  --font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --normal-green:#27ae60;
  --abnormal-orange:#e67e22;
  --critical-red:#c0392b;
}
*{box-sizing:border-box}
body{
  font-family:var(--font-family);
  background-color:var(--primary-bg);
  background-image:url('icon-512.png');
  background-repeat:no-repeat;
  background-position:center;
  background-size:150px 150px;
  color:var(--text-color);
  margin:0;
  padding:10px;
  font-size:16px;
}
.container{
  max-width:900px;
  margin:0 auto;
  background-color:var(--secondary-bg);
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  overflow:hidden;
  padding:0;
}
.header {
  padding:12px 18px;
  border-bottom:1px solid var(--border-color);
  display:flex;
  align-items:center;
  gap:12px;
}
.app-title { font-weight:700; font-size:1.1rem; color:var(--primary-accent); }
.controls { margin-left:auto; font-size:0.9rem; color:#666; display:flex; gap:8px; align-items:center; }
.tab-nav{ display:flex; background:#ecf0f1; border-bottom:1px solid var(--border-color); overflow-x:auto;}
.tab-button{
  padding:12px 16px; border:none; background:transparent; cursor:pointer;
  font-size:1rem; font-weight:600; color:var(--text-color); white-space:nowrap;
}
.tab-button.active{ background:var(--primary-accent); color:#fff; border-bottom:3px solid var(--secondary-accent); }
.tab-content{ display:none; padding:18px; animation:fadeIn .25s ease; }.tab-content.active { display: block; }@keyframes fadeIn{ from{opacity:0} to{opacity:1} }
.form-group{ margin-bottom:16px; }
.form-group label{ display:block; font-weight:600; margin-bottom:8px; }
.form-group input, .form-group textarea, .form-group select{
  width:100%; padding:10px; border:1px solid var(--border-color); border-radius:4px; font-size:1rem;
  transition: border-color 0.3s, box-shadow 0.3s;
}
.input-group{ display:flex; gap:10px; align-items:center; }
.input-group input{ flex:1; }
.input-group-addon{ background:#ecf0f1; padding:10px; border:1px solid var(--border-color); border-radius:4px; }
.gcs-section{ margin-bottom:18px; border:1px solid var(--border-color); border-radius:6px; padding:12px; }
.gcs-option{ display:block; margin-bottom:8px; }
#gcs-total{ font-size:1.2rem; font-weight:700; text-align:center; padding:10px; background:var(--primary-accent); color:#fff; border-radius:6px; margin-top:10px; }
.btn{ padding:10px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:700; }
.btn-primary{ background:var(--secondary-accent); color:#fff; }
.btn-secondary{ background:#bdc3c7; color: var(--text-color); }
.btn-danger{ background:#e74c3c; color:#fff; }
.btn-info{ background:#17a2b8; color:#fff; }
.btn-results { background: #9b59b6; color: white; }
.small{ font-size:0.9rem; color:#555; }
#results-output{ white-space:pre-wrap; background:#ecf0f1; border:1px solid var(--border-color); padding:12px; border-radius:6px; min-height:180px; font-family:"Courier New", monospace; }
.kv { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
.kv label{ min-width:110px; font-weight:700; color:#333; }
.alert-banner{
  padding:10px 12px; border-radius:6px; color:#fff; margin-bottom:12px; font-weight:700;
  display:flex; align-items:center; gap:10px;
}
.alert-none{ display:none; }
.alert-amber{ background:var(--warn-amber); }
.alert-red{ background:var(--warn-red); }
.alert-info{ background:#17a2b8; }
.log-list{ border:1px dashed var(--border-color); padding:8px; border-radius:6px; max-height:200px; overflow:auto; background:#fff; }
.log-item{ padding:6px 8px; border-bottom:1px solid #f1f1f1; font-size:0.95rem; }
.meta{ font-size:0.85rem; color:#666; }
.toggle-row{ display:flex; align-items:center; gap:8px; }
.row { display:flex; gap:10px; align-items:center; }
.flex-2{ flex:2; }
.flex-1{ flex:1; }
.small-btn{ padding:6px 8px; border-radius:6px; font-weight:700; border:none; cursor:pointer; }
.ghost{ background:transparent; border:1px solid var(--border-color); }

/* New styles for vitals chart */
.vitals-chart {
  display: flex;
  align-items: flex-end;
  height: 100px;
  margin: 10px 0;
  border-left: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
}
.chart-title {
  width: 100%;
  text-align: center;
  font-size: 0.9rem;
  margin-bottom: 5px;
}
.chart-bar {
  flex: 1;
  background-color: var(--primary-accent);
  margin: 0 2px;
  min-height: 5px;
}

/* Patient selector styles */
.patient-selector {
  margin-bottom: 16px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 6px;
  border: 1px solid var(--border-color);
}
.patient-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}
.patient-chip {
  padding: 6px 12px;
  background: #bdc3c7; /* Changed to grey for inactive patients */
  color: white;
  border-radius: 20px;
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}
.patient-chip.active {
  background: var(--secondary-accent); /* Green for active patient */
}
.patient-chip .remove {
  font-weight: bold;
  margin-left: 4px;
}
.current-patient {
  font-weight: bold;
  color: var(--primary-accent);
  margin-bottom: 8px;
}

/* Current patient display for tabs */
.tab-patient-header {
  background: #f0f7f4;
  border-left: 4px solid var(--secondary-accent);
  padding: 8px 12px;
  margin: -18px -18px 16px -18px;
  font-weight: 600;
  color: var(--secondary-accent);
  display: flex;
  align-items:center;
  gap: 8px;
}
.tab-patient-header .patient-indicator {
  font-size: 0.8rem;
  background: var(--secondary-accent);
  color: white;
  padding: 2px 6px;
  border-radius: 10px;
}

/* Update notification styles */
.update-notification {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--primary-accent);
  color: white;
  padding: 12px 16px;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 1000;
  max-width: 300px;
}
.update-notification .update-actions {
  margin-top: 8px;
  display: flex;
  gap: 8px;
}
.update-notification .update-actions button {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

/* Options group styling */
.options-group {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}
.options-group .form-group {
  margin-bottom: 0;
  flex: 1;
}

/* Priority indicator styles */
.priority-indicator {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: bold;
  font-size: 0.85rem;
  margin-left: 8px;
}
.priority-p1 { background: #e74c3c; color: white; }
.priority-p2 { background: #f39c12; color: white; }
.priority-p3 { background: #3498db; color: white; }
.priority-p4 { background: #95a5a6; color: white; }

/* Color-coded vital indicators */
.vital-normal {
  border-color: var(--normal-green) !important;
  box-shadow: 0 0 0 2px rgba(39, 174, 96, 0.2) !important;
}
.vital-abnormal {
  border-color: var(--abnormal-orange) !important;
  box-shadow: 0 0 0 2px rgba(230, 126, 34, 0.2) !important;
}
.vital-critical {
  border-color: var(--critical-red) !important;
  box-shadow: 0 0 0 2px rgba(192, 57, 43, 0.3) !important;
}

/* Color indicators in log display */
.vital-value-normal { color: var(--normal-green); font-weight: 600; }
.vital-value-abnormal { color: var(--abnormal-orange); font-weight: 600; }
.vital-value-critical { color: var(--critical-red); font-weight: 700; }

/* Info icon and modal styles */
.info-icon {
  display: inline-block;
  width: 16px;
  height: 16px;
  background-color: var(--primary-accent);
  color: white;
  border-radius: 50%;
  text-align: center;
  line-height: 16px;
  font-size: 12px;
  font-weight: bold;
  margin-left: 6px;
  cursor: pointer;
  vertical-align: middle;
}

.info-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
  overflow: auto;
}

.info-modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 500px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  position: relative;
}

.info-modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  font-weight: bold;
  color: #777;
  cursor: pointer;
}

.info-modal-close:hover {
  color: #333;
}

.vital-range-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
.vital-range-table th, .vital-range-table td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}
.vital-range-table th {
  background-color: #f2f2f2;
}
.range-normal { color: var(--normal-green); font-weight: 600; }
.range-abnormal { color: var(--abnormal-orange); font-weight: 600; }
.range-critical { color: var(--critical-red); font-weight: 700; }

/* Results modal styles */
.results-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
  overflow: auto;
}

.results-modal-content {
  background-color: #fff;
  margin: 2% auto;
  padding: 0;
  border-radius: 8px;
  width: 95%;
  max-width: 900px;
  max-height: 95vh;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  position: relative;
  overflow: hidden;
}

.results-modal-header {
  background: var(--primary-accent);
  color: white;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.results-modal-close {
  font-size: 28px;
  font-weight: bold;
  color: white;
  cursor: pointer;
  background: none;
  border: none;
}

.results-modal-close:hover {
  opacity: 0.8;
}

.results-modal-body {
  padding: 20px;
  max-height: calc(95vh - 60px);
  overflow-y: auto;
}

/* Three-dot menu styles */
.menu-container {
  position: relative;
  display: inline-block;
}

.menu-button {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text-color);
  cursor: pointer;
  padding: 5px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

.menu-button:hover {
  background-color: rgba(0,0,0,0.1);
}

.menu-dropdown {
  display: none;
  position: absolute;
  right: 0;
  top: 100%;
  background-color: white;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1001;
  border-radius: 6px;
  overflow: hidden;
  margin-top: 5px;
}

.menu-dropdown a {
  color: var(--text-color);
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-size: 14px;
  transition: background-color 0.3s;
}

.menu-dropdown a:hover {
  background-color: #f1f1f1;
}

.menu-dropdown a:first-child {
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}

.menu-dropdown a:last-child {
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
}

.show { display: block; }

/* Pupils input group styling */
.pupils-input-group {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}
.pupils-input-group input {
  flex: 1;
  min-width: 80px;
}
.pupils-checkbox {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
}
.pupils-checkbox input[type="checkbox"] {
  width: auto;
  margin: 0;
}
.pupils-checkbox label {
  font-weight: normal;
  margin: 0;
  font-size: 0.9rem;
  color: var(--text-color);
}

/* GCS Info Section Styles */
.gcs-info-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.gcs-section-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 10px;
}

.gcs-total-info {
  margin-top: 20px;
  padding: 12px;
  background-color: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid var(--primary-accent);
}

.gcs-total-info h4 {
  margin-top: 0;
  margin-bottom: 8px;
  color: var(--primary-accent);
}

.gcs-total-info p {
  margin-bottom: 6px;
}

.gcs-total-info ul {
  margin-top: 8px;
  margin-bottom: 0;
  padding-left: 20px;
}

@media (max-width:700px){
  .kv label{ min-width:90px; }
  .header{ flex-direction:column; align-items:flex-start; gap:6px; }
  .controls { flex-direction: column; align-items: flex-start; margin-left: 0; margin-top: 8px; width: 100%; }
  .controls .menu-container { align-self: flex-end; }
  .options-group {
    flex-direction: column;
    gap: 8px;
  }
  .info-modal-content {
    width: 95%;
    margin: 5% auto;
  }
  .results-modal-content {
    width: 98%;
    margin: 1% auto;
  }
  .pupils-input-group {
    flex-direction: column;
    align-items: stretch;
  }
  .pupils-checkbox {
    margin-top: 6px;
  }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="app-title">Start Vitals</div>
    <div class="controls">
      <button class="btn btn-results" onclick="showResults()">Results</button>
      <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu()">⋮</button>
        <div id="menu-dropdown" class="menu-dropdown">
          <a href="#" onclick="checkForUpdates(); toggleMenu(); return false;">Check for Updates</a>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-nav" role="tablist">
    <button class="tab-button active" onclick="openTab(event,'patient-info')">Patient Info</button>
    <button class="tab-button" onclick="openTab(event,'vitals')">Vitals</button>
    <button class="tab-button" onclick="openTab(event,'gcs')">GCS</button>
    <button class="tab-button" onclick="openTab(event,'notes')">Notes</button>
  </div>

  <!-- PATIENT INFO -->
  <div id="patient-info" class="tab-content active">
    <div class="tab-patient-header">
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="patient-info-current">New Patient</span>
    </div>
    
    <h2>Patient Information</h2>

    <!-- Patient selector -->
    <div class="patient-selector">
      <div class="form-group">
        <label>Current Patient</label>
        <div id="current-patient-display" class="current-patient">New Patient</div>
        <div id="patient-list" class="patient-list"></div>
        <button id="add-patient-btn" class="btn btn-primary small-btn" onclick="addPatient()" style="margin-top: 8px;">+ Add Patient</button>
      </div>
    </div>

... (file continues)



