<!-- Add this button to your tab-nav section -->
<button class="tab-button cpr-active" onclick="openTab(event,'cpr')">CPR</button>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Start Vitals</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3498db">
<link rel="stylesheet" href="styles.css">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then(registration => {
        window.swRegistration = registration;
        setInterval(() => {
          registration.update();
        }, 60 * 60 * 1000);
      }).catch(()=>{/*sw failed*/});
    });
  }
</script>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="app-title">Start Vitals</div>
    <div class="controls">
      <button class="btn btn-results" onclick="showResults()">Results</button>
      <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu()">⋮</button>
        <div id="menu-dropdown" class="menu-dropdown">
          <a href="#" onclick="checkForUpdates(); toggleMenu(); return false;">Check for Updates</a>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-nav" role="tablist">
    <button class="tab-button active" onclick="openTab(event,'patient-info')">Patient Info</button>
    <button class="tab-button" onclick="openTab(event,'vitals')">Vitals</button>
    <button class="tab-button" onclick="openTab(event,'gcs')">GCS</button>
    <button class="tab-button cpr-active" onclick="openTab(event,'cpr')">CPR</button>
    <button class="tab-button" onclick="openTab(event,'notes')">Notes</button>
  </div>

<!-- Add this CPR tab content after your GCS tab -->
<div id="cpr" class="tab-content">
  <!-- PATIENT INFO -->
  <div id="patient-info" class="tab-content active">
    <div class="tab-patient-header">
        <span class="patient-indicator">CURRENT PATIENT</span>
        <span id="cpr-current">New Patient</span>
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="patient-info-current">New Patient</span>
    </div>

    <h2>CPR Management</h2>
    <div id="cpr-alert" class="alert-banner alert-none"></div>

    <!-- CPR Sub-tabs -->
    <div class="cpr-sub-tabs">
        <button class="cpr-sub-tab active" onclick="openCprTab(event, 'metronome')">Metronome</button>
        <button class="cpr-sub-tab" onclick="openCprTab(event, 'events')">Events</button>
        <button class="cpr-sub-tab" onclick="openCprTab(event, 'timeline')">Timeline</button>
    </div>

    <!-- Metronome Tab -->
    <div id="cpr-metronome" class="cpr-sub-content active">
        <div class="metronome-container">
            <div id="metronome-display" class="metronome-display">
                <div id="metronome-beat" class="metronome-beat"></div>
                <div id="metronome-rate" class="metronome-rate">100</div>
                <div>bpm</div>
            </div>

            <div class="metronome-controls">
                <div class="metronome-buttons">
                    <button id="metronome-start" class="btn btn-primary" onclick="toggleMetronome()">Start</button>
                    <button id="metronome-reset" class="btn btn-secondary" onclick="resetMetronome()">Reset</button>
                </div>

                <div class="form-group">
                    <label for="metronome-slider">Compression Rate: <span id="rate-value">100</span> bpm</label>
                    <input id="metronome-slider" class="metronome-slider" type="range" min="80" max="120" value="100" step="1" oninput="updateMetronomeRate(this.value)">
                </div>

                <div class="form-group">
                    <label class="toggle-row">
                        <input type="checkbox" id="audio-enabled" checked>
                        Enable Audio Beep
                    </label>
                </div>

                <div id="compression-counter" class="compression-counter">0</div>
                <div id="compression-cycle" class="compression-cycle">Cycle: 0/0</div>
                <div id="cpr-timer" class="cpr-timer">00:00</div>
            </div>
        </div>
    <h2>Patient Information</h2>
    
    <!-- Patient selector -->
    <div class="patient-selector">
      <div class="form-group">
        <label>Current Patient</label>
        <div id="current-patient-display" class="current-patient">New Patient</div>
        <div id="patient-list" class="patient-list"></div>
        <button id="add-patient-btn" class="btn btn-primary small-btn" onclick="addPatient()" style="margin-top: 8px;">+ Add Patient</button>
      </div>
    </div>

    <!-- Events Tab -->
    <div id="cpr-events" class="cpr-sub-content">
        <div class="form-group">
            <label>Rhythm</label>
            <select id="rhythm-select">
                <option value="">Select rhythm</option>
                <option value="unknown">Unknown</option>
                <option value="vf">VF (Ventricular Fibrillation)</option>
                <option value="vt">VT (Ventricular Tachycardia)</option>
                <option value="asystole">Asystole</option>
                <option value="pea">PEA (Pulseless Electrical Activity)</option>
            </select>
            <button class="btn btn-primary" onclick="logRhythmChange()">Log Rhythm</button>
        </div>
    <div class="form-group">
      <label for="patient-name">Name</label>
      <input id="patient-name" placeholder="e.g., John Doe" onchange="patientNameChanged()">
    </div>
    <div class="form-group">
      <label for="responder-id">Responder ID</label>
      <input id="responder-id" placeholder="e.g., ST186" onchange="patientInfoChanged()">
    </div>
    <div class="form-group">
      <label for="incident-type">Incident Type</label>
      <select id="incident-type" onchange="patientInfoChanged()">
        <option value="">Select incident type</option>
        <option value="MVA - Motor Vehicle Accident">MVA - Motor Vehicle Accident</option>
        <option value="Fall">Fall</option>
        <option value="Cardiac Arrest">Cardiac Arrest</option>
        <option value="Chest Pain">Chest Pain</option>
        <option value="Stroke / TIA">Stroke / TIA</option>
        <option value="Breathing Difficulty">Breathing Difficulty</option>
        <option value="Diabetic Emergency">Diabetic Emergency</option>
        <option value="Seizure">Seizure</option>
        <option value="Allergic Reaction">Allergic Reaction</option>
        <option value="Trauma">Trauma</option>
        <option value="Burns">Burns</option>
        <option value="Overdose / Poisoning">Overdose / Poisoning</option>
        <option value="Psychiatric Emergency">Psychiatric Emergency</option>
        <option value="Obstetric Emergency">Obstetric Emergency</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="form-group">
      <label for="patient-age">Age</label>
      <input id="patient-age" type="number" placeholder="e.g., 35" onchange="patientInfoChanged()">
    </div>
    <div class="form-group">
      <label for="allergies">Allergies</label>
      <input id="allergies" placeholder="e.g., Penicillin, Peanuts" onchange="patientInfoChanged()">
    </div>
    <div class="form-group">
      <label for="medication">Medication</label>
      <input id="medication" placeholder="e.g., Metformin, Lisinopril" onchange="patientInfoChanged()">
    </div>
    <div class="form-group">
      <label for="history">Past History</label>
      <input id="history" placeholder="e.g., Diabetes, Hypertension" onchange="patientInfoChanged()">
    </div>
    <div class="form-group">
      <label for="last-intake">Last Intake (Food/Drink)</label>
      <input id="last-intake" placeholder="e.g., Water at 10:00 AM" onchange="patientInfoChanged()">
    </div>
  </div>

        <div class="form-group">
            <label>Shock</label>
            <div class="input-group">
                <input id="shock-energy" type="number" placeholder="Energy (J)" min="1" max="360">
                <button class="btn btn-danger" onclick="logShock()">Deliver Shock</button>
            </div>
        </div>
  <!-- VITALS -->
  <div id="vitals" class="tab-content">
    <div class="tab-patient-header">
      <span class="patient-indicator">CURRENT PATIENT</span>
      <span id="vitals-current">New Patient</span>
    </div>
    
    <h2>Vitals</h2>
    <div id="vitals-alert" class="alert-banner alert-none"></div>

        <div class="form-group">
            <label>Medication</label>
            <select id="medication-select" onchange="handleMedicationChange()">
                <option value="">Select medication</option>
                <option value="amiodarone">Amiodarone</option>
                <option value="lidocaine">Lidocaine</option>
                <option value="calcium">Calcium Chloride</option>
                <option value="sodium-bicarb">Sodium Bicarbonate</option>
                <option value="epinephrine">Epinephrine</option>
                <option value="other">Other</option>
            </select>
            <div id="other-med-group" class="form-group" style="display:none;">
                <input id="other-medication" type="text" placeholder="Specify medication">
            </div>
            <div id="epi-dose-group" class="form-group" style="display:none;">
                <label>Epinephrine Dose</label>
                <div class="input-group">
                    <input id="epi-dose" type="number" value="1" min="1" max="10">
                    <span class="input-group-addon">mg</span>
                </div>
                <label>Interval</label>
                <select id="epi-interval">
                    <option value="3">Every 3 minutes</option>
                    <option value="4">Every 4 minutes</option>
                    <option value="5">Every 5 minutes</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="logMedication()">Log Medication</button>
        </div>
    <!-- Patient Priority -->
    <div class="form-group">
      <label for="patient-priority">Patient Priority</label>
      <select id="patient-priority" onchange="patientPriorityChanged()">
        <option value="">Select priority</option>
        <option value="P1">P1 - Immediate (Critical/Urgent)</option>
        <option value="P2">P2 - Urgent (Serious)</option>
        <option value="P3">P3 - Delayed (Walking Wounded)</option>
        <option value="P4">P4 - Deceased</option>
      </select>
    </div>

        <div class="form-group">
            <label>Intervention</label>
            <select id="intervention-select" onchange="handleInterventionChange()">
                <option value="">Select intervention</option>
                <option value="intubation">Intubation</option>
                <option value="needle-decomp">Needle Decompression</option>
                <option value="chest-tube">Chest Tube</option>
                <option value="central-line">Central Line</option>
                <option value="io">IO Access</option>
                <option value="iv">IV Access</option>
                <option value="other-int">Other</option>
            </select>
            <div id="other-int-group" class="form-group" style="display:none;">
                <input id="other-intervention" type="text" placeholder="Specify intervention">
            </div>
            <div id="int-notes-group" class="form-group" style="display:none;">
                <label>Intervention Notes</label>
                <textarea id="intervention-notes" placeholder="Add details about the intervention..."></textarea>
            </div>
            <button class="btn btn-primary" onclick="logIntervention()">Log Intervention</button>
        </div>
    <div class="form-group">
      <label>Blood Pressure (mmHg)<span class="info-icon" onclick="showVitalInfo('bp')">?</span></label>
      <div class="input-group">
        <input id="bp-sys" type="number" placeholder="Systolic" oninput="updateVitalIndicator(this, 'bp-sys')">
        <span>/</span>
        <input id="bp-dia" type="number" placeholder="Diastolic" oninput="updateVitalIndicator(this, 'bp-dia')">
        <span class="input-group-addon">mmHg</span>
      </div>
    </div>

        <div>
            <label class="small">Recent Events</label>
            <div id="cpr-events-log" class="log-list" aria-live="polite"></div>
        </div>
    <div class="form-group">
      <label for="pulse">Pulse<span class="info-icon" onclick="showVitalInfo('pulse')">?</span></label>
      <div class="input-group">
        <input id="pulse" type="number" placeholder="e.g., 80" oninput="updateVitalIndicator(this, 'pulse')">
        <span class="input-group-addon">bpm</span>
      </div>
    </div>

    <!-- Timeline Tab -->
    <div id="cpr-timeline" class="cpr-sub-content">
        <div>
            <label class="small">CPR Timeline</label>
            <div id="cpr-timeline-log" class="log-list" aria-live="polite"></div>
        </div>
    <div class="form-group">
      <label for="spo2">SPO₂<span class="info-icon" onclick="showVitalInfo('spo2')">?</span></label>
      <div class="input-group">
        <input id="spo2" type="number" placeholder="e.g., 98" oninput="updateVitalIndicator(this, 'spo2')">
        <span class="input-group-addon">%</span>
      </div>
    </div>
</div>

<!-- Add this modal after your results modal -->
<!-- Pulse Check Modal -->
<div id="pulse-check-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Pulse Check</div>
            <span class="modal-close" onclick="closePulseCheckModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Two minutes of CPR completed. Check for pulse.</p>
            <div class="form-group">
                <label>Pulse Status</label>
                <div class="toggle-row">
                    <button class="btn btn-primary" onclick="pulseDetected()">Pulse Detected</button>
                    <button class="btn btn-danger" onclick="noPulseDetected()">No Pulse</button>
                </div>
            </div>
        </div>
    <div class="form-group">
      <label>O₂ Delivery<span class="info-icon" onclick="showVitalInfo('o2')">?</span></label>
      <select id="o2-delivery">
        <option value="">None</option>
        <option value="nasal">Nasal Cannula</option>
        <option value="mask">Face Mask</option>
        <option value="non-rebreather">Non-rebreather Mask</option>
        <option value="bag-valve">Bag-Valve Mask</option>
      </select>
    </div>

    <div class="form-group">
      <label for="o2-flow">O₂ Flow Rate<span class="info-icon" onclick="showVitalInfo('o2-flow')">?</span></label>
      <div class="input-group">
        <input id="o2-flow" type="number" placeholder="e.g., 2" step="0.5">
        <span class="input-group-addon">L/min</span>
      </div>
    </div>

    <div class="form-group">
      <label for="rrate">Respiratory Rate<span class="info-icon" onclick="showVitalInfo('rrate')">?</span></label>
      <div class="input-group">
        <input id="rrate" type="number" placeholder="e.g., 16" oninput="updateVitalIndicator(this, 'rrate')">
        <span class="input-group-addon">/min</span>
      </div>
    </div>
</div>

    <div class="form-group">
      <label for="hgt">Blood Glucose (HGT)<span class="info-icon" onclick="showVitalInfo('hgt')">?</span></label>
      <div class="input-group">
        <input id="hgt" type="number" step="0.1" placeholder="e.g., 5.5" oninput="updateVitalIndicator(this, 'hgt')">
        <span class="input-group-addon">mmol/L</span>
      </div>
    </div>

    <div class="form-group">
      <label for="temp">Temperature<span class="info-icon" onclick="showVitalInfo('temp')">?</span></label>
      <div class="input-group">
        <input id="temp" type="number" step="0.1" placeholder="e.g., 36.8" oninput="updateVitalIndicator(this, 'temp')">
        <span class="input-group-addon">°C</span>
      </div>
    </div>

    <div class="form-group">
      <label for="cap-refill">Capillary Refill<span class="info-icon" onclick="showVitalInfo('cap-refill')">?</span></label>
      <div class="input-group">
        <input id="cap-refill" type="number" placeholder="e.g., 2" oninput="updateVitalIndicator(this, 'cap-refill')">
        <span class="input-group-addon">s</span>
      </div>
    </div>

    <div class="form-group">
      <label>Pupils (Left / Right)<span class="info-icon" onclick="showVitalInfo('pupils')">?</span></label>
      <div class="pupils-input-group">
        <input id="pupil-left" type="number" placeholder="L mm">
        <input id="pupil-right" type="number" placeholder="R mm">
        <span class="input-group-addon">mm</span>
      </div>
      <div class="pupils-checkbox">
        <input type="checkbox" id="pupils-reactive" onchange="patientInfoChanged()">
        <label for="pupils-reactive">Pupils reactive to light</label>
      </div>
    </div>

    <div class="form-group">
      <label for="pain">Pain Score<span class="info-icon" onclick="showVitalInfo('pain')">?</span></label>
      <div class="input-group">
        
